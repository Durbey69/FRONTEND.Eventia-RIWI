<section class="tickets-container mat-elevation-z2">
  <h1>Listado de Tickets</h1>

  <div class="actions-bar">
    <button mat-raised-button color="primary" (click)="irACrearTicket()">
      <mat-icon>add</mat-icon>
      Crear Ticket
    </button>

    <button
        *ngIf="!esAgente"
        mat-raised-button
        color="accent"
        (click)="irAUsuarios()"
      >
        <mat-icon>people</mat-icon>
        Ver Usuarios
      </button>


  </div>

  @if (loading(); as isLoading) {
    <div class="loading-container">
      <mat-spinner *ngIf="isLoading" diameter="40"></mat-spinner>
    </div>
  } @else {
    @if (error(); as errMsg) {
      <p class="error">{{ errMsg }}</p>
    }

    @if (tickets().length === 0) {
      <p>No hay tickets registrados.</p>
    } @else {
      <table mat-table [dataSource]="tickets()" class="mat-elevation-z1 full-width-table">

        <!-- Columnas -->
        <ng-container matColumnDef="titulo">
          <th mat-header-cell *matHeaderCellDef> TÃ­tulo </th>
          <td mat-cell *matCellDef="let ticket"> {{ ticket.titulo }} </td>
        </ng-container>

        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef> Estado </th>
          <td mat-cell *matCellDef="let ticket">
            {{ EstadoTicket[ticket.estado] || 'Desconocido' }}
          </td>

        </ng-container>

        <ng-container matColumnDef="asignado">
          <th mat-header-cell *matHeaderCellDef> Asignado a </th>
          <td mat-cell *matCellDef="let ticket"> {{ ticket.nombreUsuarioAsignado || 'Sin asignar' }} </td>
        </ng-container>

        <!-- Acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef> Acciones </th>
          <td mat-cell *matCellDef="let ticket">
            <button mat-icon-button color="primary" (click)="verTicket(ticket.id)" matTooltip="Ver">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button color="accent" (click)="editarTicket(ticket.id)" matTooltip="Editar">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="eliminarTicket(ticket.id)" matTooltip="Eliminar">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columnas"></tr>
        <tr mat-row *matRowDef="let row; columns: columnas;"></tr>
      </table>
    }
  }
</section>
